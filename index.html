<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Birthday Escape</title>
	<style>
		:root {
			--bg: #0b0a1c;
			--card: #14112a;
			--accent: #ff4fd8;
			--accent-2: #7c4dff;
			--accent-3: #45f5ff;
			--text: #f7f5ff;
			--muted: #b9b4d3;
			--success: #43f6a2;
			--danger: #ff5d7d;
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
			background:
				radial-gradient(900px 500px at 15% 10%, rgba(255, 79, 216, 0.25), transparent 60%),
				radial-gradient(900px 500px at 85% 20%, rgba(124, 77, 255, 0.25), transparent 60%),
				radial-gradient(900px 500px at 50% 90%, rgba(69, 245, 255, 0.25), transparent 60%),
				var(--bg);
			color: var(--text);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 24px;
		}

		.container {
			width: min(980px, 100%);
			background: linear-gradient(140deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
			border-radius: 22px;
			box-shadow: 0 30px 70px rgba(0, 0, 0, 0.45);
			padding: 28px;
			border: 1px solid rgba(255, 255, 255, 0.08);
			backdrop-filter: blur(10px);
			display: grid;
			gap: 24px;
		}

		header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 16px;
			flex-wrap: wrap;
		}

		.title {
			font-size: clamp(22px, 3vw, 30px);
			font-weight: 700;
			letter-spacing: 0.4px;
		}

		.subtitle {
			color: var(--muted);
			font-size: 14px;
		}

		.progress {
			background: #0c0c1e;
			border-radius: 999px;
			height: 12px;
			overflow: hidden;
			position: relative;
			box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
		}

		.progress > span {
			display: block;
			height: 100%;
			background: linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
			width: 0;
			transition: width 0.3s ease;
			box-shadow: 0 0 20px rgba(255, 79, 216, 0.35);
		}

		.step-dots {
			display: flex;
			gap: 10px;
			align-items: center;
			flex-wrap: wrap;
			margin-top: 10px;
		}

		.step-dot {
			width: 14px;
			height: 14px;
			border-radius: 50%;
			background: #2a2947;
			border: 2px solid rgba(255, 255, 255, 0.2);
			box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.2);
			transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
		}

		.step-dot.active {
			background: var(--accent);
			border-color: rgba(255, 255, 255, 0.5);
			box-shadow: 0 0 10px rgba(255, 79, 216, 0.8);
			transform: scale(1.15);
		}

		.step-dot.done {
			background: var(--accent-3);
			border-color: rgba(255, 255, 255, 0.6);
			box-shadow: 0 0 10px rgba(69, 245, 255, 0.7);
		}

		.video-card {
			background: rgba(10, 11, 28, 0.85);
			border-radius: 16px;
			padding: 16px;
			display: grid;
			gap: 16px;
			border: 1px solid rgba(255, 255, 255, 0.06);
		}

		iframe {
			width: 100%;
			aspect-ratio: 16 / 9;
			border: none;
			border-radius: 12px;
			background: #000;
		}

		.clue {
			font-size: 16px;
			color: var(--text);
		}

		.controls {
			display: grid;
			gap: 12px;
		}

		.input-row {
			display: grid;
			grid-template-columns: 1fr auto;
			gap: 12px;
		}

		input[type="text"] {
			padding: 12px 14px;
			border-radius: 10px;
			border: 1px solid #2a2f4f;
			background: #0f1328;
			color: var(--text);
			font-size: 15px;
			outline: none;
		}

		input[type="text"]:focus {
			border-color: var(--accent-2);
			box-shadow: 0 0 0 2px rgba(124, 243, 255, 0.2);
		}

		button {
			padding: 12px 18px;
			border-radius: 12px;
			border: none;
			background: linear-gradient(120deg, var(--accent), var(--accent-2), var(--accent-3));
			color: #0b0f1f;
			font-weight: 800;
			cursor: pointer;
			letter-spacing: 0.4px;
			transition: transform 0.15s ease, box-shadow 0.2s ease;
			box-shadow: 0 10px 20px rgba(255, 79, 216, 0.25);
		}

		button:active {
			transform: scale(0.98);
		}

		.secondary {
			background: rgba(15, 19, 40, 0.9);
			color: var(--muted);
			border: 1px solid #2a2f4f;
			box-shadow: none;
		}

		.feedback {
			min-height: 24px;
			font-size: 14px;
			color: var(--muted);
		}

		.feedback.success {
			color: var(--success);
		}

		.feedback.error {
			color: var(--danger);
		}

		.footer {
			display: flex;
			gap: 12px;
			justify-content: space-between;
			flex-wrap: wrap;
			color: var(--muted);
			font-size: 12px;
		}

		.link {
			color: var(--accent-2);
			text-decoration: none;
		}
	</style>
</head>

<body>
	<div class="container">
		<header>
			<div>
				<div class="title">Birthday Escape</div>
				<div class="subtitle">Solve each video clue to unlock the next one.</div>
			</div>
			<div style="min-width: 220px; flex: 1;">
				<div class="progress" aria-label="Progress">
					<span id="progressBar"></span>
				</div>
				<div class="step-dots" id="stepDots" aria-label="Step markers"></div>
			</div>
		</header>

		<section class="video-card">
			<iframe id="videoFrame" title="Clue video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
			<div class="clue" id="clueText"></div>
		</section>

		<section class="controls">
			<div class="input-row">
				<input id="answerInput" type="text" placeholder="Type the answer from the video" autocomplete="off" />
				<button id="submitButton" type="button">Unlock</button>
			</div>
			<div class="feedback" id="feedback"></div>
			<div style="display: flex; gap: 12px; flex-wrap: wrap;">
				<button id="openYoutube" class="secondary" type="button">Open on YouTube</button>
				<button id="resetProgress" class="secondary" type="button">Reset progress</button>
			</div>
		</section>

		<div class="footer">
			<div>Tip: answers are not case-sensitive.</div>
			<div>Built with ‚ù§ From your favorite Human</div>
		</div>
	</div>

	<script>
		const steps = [
			{
				id: 1,
				videoId: "pkTbPj2uB2Y",
				prompt: "What's the answer?",
				answers: ["famille", "Famille"],
				successMessage: "Good job !"
			},
			{
				id: 2,
				videoId: "Qhu6roH6QSY",
				prompt: "Emma & Hugo: What's the answer?",
				answers: ["64", "64s", "1:04", "1 04", "1min 04", "1 min 04", "1min04", "1min04s", "1min 04s", "1 min 04s", "1:04s"],
				successMessage: "Good job !"
			},
			{
				id: 3,
				videoId: "Wky6CNcocYQ",
				prompt: "What's the answer?",
				answers: ["home", "home!", "Home", "Home!"],
				successMessage: "Good job !"
			},
			{
				id: 4,
				videoId: "KE1F0hf01m4",
				prompt: "Anne: What's the answer?",
				answers: ["aligator", "alligator", "ali-gator", "ali gator"],
				successMessage: "Good job !"
			},
			{
				id: 5,
				videoId: "dXLEpXMvjw4",
				prompt: "Nana's team: What's the answer?",
				answers: ["emoji"],
				successMessage: "Good job !"
			},
			{
				id: 6,
				videoId: "O6nALjtHTh8",
				prompt: "Parents: What's the answer?",
				answers: ["treasure"],
				successMessage: "Good job !"
			},
			{
				id: 7,
				videoId: "5WNW_e3QRlc",
				prompt: "Lucas: What's the answer?",
				answers: ["outer wilds", "outerwilds"],
				successMessage: "Good job !"
			},
			{
				id: 8,
				videoId: "WCfme8C1l6Y",
				prompt: "Mel & Tmo: What's the answer?",
				answers: ["3784", "3785"],
				successMessage: "Good job !"
			},
			{
				id: 9,
				videoId: "9ScR48O30H0",
				prompt: "Miss Rey: What's the answer?",
				answers: ["once you go black you never come back", "Once you go black you never come back", "once you go black, you never come back", "Once you go black, you never come back"],
				successMessage: "Good job !"
			}
		];

		const storageKey = "escape-step-index";
		const videoFrame = document.getElementById("videoFrame");
		const clueText = document.getElementById("clueText");
		const answerInput = document.getElementById("answerInput");
		const feedback = document.getElementById("feedback");
		const progressBar = document.getElementById("progressBar");
		const stepDots = document.getElementById("stepDots");
		const openYoutube = document.getElementById("openYoutube");
		const resetProgress = document.getElementById("resetProgress");

		const normalize = (value) => value
			.toLowerCase()
			.normalize("NFD")
			.replace(/\p{Diacritic}/gu, "")
			.replace(/[^a-z0-9]+/g, " ")
			.trim();

		const getIndex = () => {
			const raw = localStorage.getItem(storageKey);
			const idx = Number(raw);
			return Number.isFinite(idx) && idx >= 0 && idx < steps.length ? idx : 0;
		};

		const setIndex = (idx) => {
			localStorage.setItem(storageKey, String(idx));
		};

		const renderDots = (idx) => {
			stepDots.innerHTML = "";
			steps.forEach((step, stepIndex) => {
				const dot = document.createElement("span");
				dot.className = "step-dot";
				if (stepIndex < idx) dot.classList.add("done");
				if (stepIndex === idx) dot.classList.add("active");
				stepDots.appendChild(dot);
			});
		};

		const renderStep = (idx) => {
			const step = steps[idx];
			const embedUrl = `https://www.youtube.com/embed/${step.videoId}?rel=0`;
			videoFrame.src = embedUrl;
			clueText.textContent = step.prompt;
			feedback.textContent = "";
			feedback.className = "feedback";
			answerInput.value = "";
			answerInput.focus();
			const progress = ((idx) / (steps.length)) * 100;
			progressBar.style.width = `${progress}%`;
			renderDots(idx);
			openYoutube.onclick = () => window.open(`https://youtu.be/${step.videoId}`, "_blank");
		};

		const unlockNext = () => {
			let idx = getIndex();
			const userAnswer = normalize(answerInput.value);
			const stepMatches = steps
				.map((step, stepIndex) => ({
					stepIndex,
					answers: step.answers.map(normalize)
				}))
				.filter((entry) => entry.answers.includes(userAnswer));

			if (!userAnswer) {
				feedback.textContent = "Type an answer first.";
				feedback.className = "feedback error";
				return;
			}

			if (stepMatches.length > 0) {
				const highestMatch = Math.max(...stepMatches.map((entry) => entry.stepIndex));
				const nextIndex = Math.min(highestMatch + 1, steps.length);
				const messageIndex = Math.min(highestMatch, steps.length - 1);
				feedback.textContent = steps[messageIndex].successMessage + (highestMatch > idx ? " Shortcut applied!" : "");
				feedback.className = "feedback success";

				if (nextIndex >= steps.length) {
					setIndex(steps.length - 1);
					progressBar.style.width = "100%";
					renderDots(steps.length - 1);
					clueText.textContent = "All clues solved. Share a smile!";
					return;
				}

				setIndex(nextIndex);
				setTimeout(() => renderStep(nextIndex), 600);
				return;
			}

			feedback.textContent = "Not quite. Try again.";
			feedback.className = "feedback error";
		};

		document.getElementById("submitButton").addEventListener("click", unlockNext);
		answerInput.addEventListener("keydown", (event) => {
			if (event.key === "Enter") {
				unlockNext();
			}
		});

		resetProgress.addEventListener("click", () => {
			setIndex(0);
			renderStep(0);
		});

		renderStep(getIndex());
	</script>
</body>

</html>
